{"version":3,"sources":["components/LeaderAnimationsEditor.jsx"],"names":["window","PIXI","require","LeaderAnimationsEditor","props","updatePixiCnt","element","pixi_cnt","children","length","appendChild","app","view","setup","loadSpineData","animation","stage","removeChild","spine","Spine","spine_data","x","screen","width","y","height","scale","set","animScale","spineData","skins","skeleton","setSkinByName","name","addChild","state","setAnimation","loading","setState","renderButtons","animations","map","type","onClick","style","margin","key","renderSkinButtons","attachments","marginBottom","borderBottom","paddingTop","t","skin","collectImage","e","reader","FileReader","elem","onload","image","target","result","readAsDataURL","files","value","collectJson","json","readAsText","collectAtlas","atlas","redoSpine","rawSkeletonData","JSON","parse","rawAtlasData","spineAtlas","core","TextureAtlas","line","callback","BaseTexture","from","spineAtlasLoader","AtlasAttachmentLoader","spineJsonParser","SkeletonJson","readSkeletonData","innerWidth","innerHeight","transparent","this","position","top","left","ref","display","htmlFor","id","accept","onChange","React","Component","withTranslation"],"mappings":"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","file":"static/js/4.0cae8f29.chunk.js","sourcesContent":["import React from 'react';\r\nimport * as PIXI from 'pixi.js';\r\nimport { withTranslation } from 'react-i18next';\r\nimport {\r\n  ForegroundDiv,\r\n  DimBackground,\r\n  StyledDiv,\r\n  ResponsiveButton,\r\n  ResponsiveLabel,\r\n  HiddenInput\r\n} from '../styles/leaderAnimationStyles';\r\n\r\nwindow.PIXI = PIXI;\r\nrequire(\"pixi-spine\")\r\n\r\n// this component is all kinds of messed up, I should be using state properly\r\nclass LeaderAnimationsEditor extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {image: null, atlas: null, json: null};\r\n    this.loading = true;\r\n    this.pixi_cnt = null;\r\n    this.app = new PIXI.Application({width: window.innerWidth > window.innerHeight ? window.innerWidth / 2 : window.innerWidth, height: window.innerWidth > window.innerHeight ? window.innerWidth / 2 : window.innerWidth, transparent:false});\r\n    this.animation = null;\r\n    this.animScale = 0.6;\r\n    this.spine_data = null;\r\n  };\r\n\r\n  updatePixiCnt = (element) => {\r\n    this.pixi_cnt = element;\r\n    if(this.pixi_cnt && this.pixi_cnt.children.length<=0) {\r\n      this.pixi_cnt.appendChild(this.app.view);\r\n      this.setup();\r\n    }\r\n  };\r\n\r\n  setup = () => {\r\n    // this.app.loader.baseUrl = './anim/';\r\n    // this.app.loader\r\n    // .add('class.json', 'class.json')\r\n    // .load((loader, resources) => {\r\n    //     this.spine_data = resources['class.json'].spineData;\r\n    //     this.loadSpineData();\r\n    // });\r\n  };\r\n\r\n  loadSpineData = () => {\r\n    if (this.animation !== null) {\r\n      this.app.stage.removeChild(this.animation);\r\n    }\r\n\r\n    this.animation = new window.PIXI.spine.Spine(this.spine_data);\r\n\r\n    this.animation.x = this.app.screen.width / 2;\r\n    this.animation.y = this.app.screen.height / 2;\r\n    this.animation.scale.set(this.animScale);\r\n\r\n    if (this.animation.spineData.skins.length > 1) {\r\n      this.animation.skeleton.setSkinByName(this.animation.spineData.skins[1].name);\r\n    }\r\n\r\n    this.app.stage.addChild(this.animation);\r\n\r\n    this.animation.state.setAnimation(0, 'idle', true);\r\n    this.loading = false;\r\n    this.setState(this.state);\r\n  }\r\n\r\n  renderButtons = () => {\r\n    if(this.animation) {\r\n      return(\r\n        this.animation.spineData.animations.map((animation) => (\r\n          <ResponsiveButton\r\n            type=\"button\"\r\n            onClick={() => this.animation.state.setAnimation(0, animation.name, true)}\r\n            style={{ margin: '5px' }}\r\n            key={`button${animation.name}`}\r\n          >\r\n            {animation.name}\r\n          </ResponsiveButton>\r\n        ))\r\n      )\r\n    }\r\n  };\r\n\r\n  renderSkinButtons = () => {\r\n    if(this.animation\r\n      && this.animation.spineData.skins.length > 1\r\n      && this.animation.spineData.skins[1].attachments.length !== 0) {\r\n      return(\r\n        <>\r\n          <p style={{ marginBottom: '20px', borderBottom: '2px solid pink', paddingTop: '14px' }}>{this.props.t('Switch expression')}</p>\r\n          {this.animation.spineData.skins.map((skin) => (\r\n            <ResponsiveButton\r\n              type=\"button\"\r\n              onClick={() => this.animation.skeleton.setSkinByName(skin.name)}\r\n              key={`skin${skin.name}`}\r\n            >\r\n              {skin.name}\r\n            </ResponsiveButton>\r\n          ))}\r\n        </>\r\n      )\r\n    }\r\n  }\r\n\r\n  collectImage = (e) => {\r\n    var reader = new FileReader();\r\n    var elem = this;\r\n    reader.onload = (e) => {\r\n      elem.setState({image: e.target.result});\r\n    }\r\n    reader.readAsDataURL(e.target.files[0]);\r\n\r\n    e.target.value = null;\r\n  }\r\n\r\n  collectJson = (e) => {\r\n    var reader = new FileReader();\r\n    var elem = this;\r\n    reader.onload = (e) => {\r\n      elem.setState({json: e.target.result});\r\n    }\r\n    reader.readAsText(e.target.files[0]);\r\n\r\n    e.target.value = null;\r\n  }\r\n\r\n  collectAtlas = (e) => {\r\n    var reader = new FileReader();\r\n    var elem = this;\r\n    reader.onload = (e) => {\r\n      elem.setState({atlas: e.target.result});\r\n    }\r\n    reader.readAsText(e.target.files[0]);\r\n\r\n    e.target.value = null;\r\n  }\r\n\r\n  redoSpine = () => {\r\n    var rawSkeletonData = JSON.parse(this.state.json); //your skeleton.json file here\r\n    var rawAtlasData = this.state.atlas; //your atlas file \r\n\r\n    var elem = this;\r\n    var spineAtlas = new window.PIXI.spine.core.TextureAtlas(rawAtlasData, function(line, callback) {\r\n        // pass the image here.\r\n        callback(window.PIXI.BaseTexture.from(elem.state.image));\r\n    }); // specify path, image.png will be added automatically\r\n\r\n    var spineAtlasLoader = new window.PIXI.spine.core.AtlasAttachmentLoader(spineAtlas)\r\n    var spineJsonParser = new window.PIXI.spine.core.SkeletonJson(spineAtlasLoader);\r\n\r\n    this.spine_data = spineJsonParser.readSkeletonData(rawSkeletonData);\r\n\r\n    this.loadSpineData();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <DimBackground>\r\n        <ForegroundDiv>\r\n          { this.loading && <p style={{ position: 'absolute', top: '50%', left: '50%' }}>Waiting for input...</p> }\r\n          <StyledDiv ref={this.updatePixiCnt} style={{ display: this.loading ? 'hidden' : 'inline' }} />\r\n          <div style={{ display: 'inline' }}>\r\n            <p style={{ marginBottom: '20px', borderBottom: '2px solid pink', paddingTop: '14px' }}>{this.props.t('Switch animation')}</p>\r\n            <div>\r\n              {this.renderButtons()}\r\n            </div>\r\n            <div>\r\n              {this.renderSkinButtons()}\r\n            </div>\r\n            { this.animation &&\r\n            <div>\r\n              <ResponsiveButton\r\n                style={{ width: '5vw' }}\r\n                onClick={() => {\r\n                  this.animScale += 0.1\r\n                  this.animation.scale.set(this.animScale);\r\n                  }}>\r\n                Zoom +\r\n              </ResponsiveButton>\r\n              <ResponsiveButton\r\n                style={{ width: '5vw' }}\r\n                onClick={() => {\r\n                  this.animScale -= 0.1\r\n                  this.animation.scale.set(this.animScale);\r\n                  }}>\r\n                Zoom -\r\n              </ResponsiveButton>\r\n            </div>\r\n            }\r\n            <div>\r\n              <ResponsiveLabel\r\n                htmlFor=\"image\"\r\n                style={{ width: '5vw' }}>\r\n                Upload PNG {this.state.image === null ? \"(0/1)\" : \"(1/1)\" }\r\n              </ResponsiveLabel>\r\n                <HiddenInput type=\"file\" id=\"image\" accept=\"image/*\" onChange={this.collectImage} >\r\n                </HiddenInput>\r\n              <ResponsiveLabel\r\n                htmlFor=\"atlas\"\r\n                style={{ width: '5vw' }}>\r\n                Upload Atlas {this.state.atlas === null ? \"(0/1)\" : \"(1/1)\" }\r\n                <HiddenInput type=\"file\" id=\"atlas\" accept=\"*/*\" onChange={this.collectAtlas} >\r\n                </HiddenInput>\r\n              </ResponsiveLabel><ResponsiveLabel\r\n                htmlFor=\"json\"\r\n                style={{ width: '5vw' }}>\r\n                Upload JSON {this.state.json === null ? \"(0/1)\" : \"(1/1)\" }\r\n                <HiddenInput type=\"file\" id=\"json\" accept=\"json/*\" onChange={this.collectJson} >\r\n                </HiddenInput>\r\n              </ResponsiveLabel>\r\n            </div>\r\n            <div>\r\n              <ResponsiveButton\r\n                style={{ width: '5vw' }}\r\n                onClick={() => {\r\n                  this.redoSpine();\r\n                  }}>\r\n                Redo Spine\r\n              </ResponsiveButton>\r\n            </div>\r\n            <div>\r\n              <h3>Instructions</h3>\r\n              <ol style={{ \"textAlign\": 'left' }}>\r\n                <li>Use UnityEX to open ui_class_XXXX.unity3d.</li>\r\n                <li>Extract \"class_XXXX.txt\" to a file. This is the JSON file input.</li>\r\n                <li>Extract \"class_XXXX.atlas.txt\" to a file. This is the ATLAS file input.</li>\r\n                <li>Extract \"class_XXXX_A.tex\" and \"class_XXXX.tex\".</li>\r\n                <li>Edit as needed.</li>\r\n                <li>Use the alpha as a transparency map to get a partially transparent PNG file.</li>\r\n                <li>Upload to the image field.</li>\r\n                <li>Press \"Redo Spine\"</li>\r\n              </ol>\r\n            </div>\r\n          </div>\r\n\r\n        </ForegroundDiv>\r\n      </DimBackground>\r\n    );\r\n  }\r\n};\r\n\r\nexport default withTranslation()(LeaderAnimationsEditor);\r\n"],"sourceRoot":""}